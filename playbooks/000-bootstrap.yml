---
- hosts: all
  tasks:
    - name: ensure apt is configured
      tags: apt
      ansible.builtin.include_role:
        name: apt
        apply:
          tags: apt

    - name: ensure tools packages are installed
      become: true
      tags: tools
      ansible.builtin.apt:
        name: [git, sudo, vim, zsh]

    - name: ensure system users are configured
      tags: system_users
      ansible.builtin.include_role:
        name: system_users
        apply:
          tags: system_users

    - name: ensure sshd is configured
      tags: sshd
      ansible.builtin.include_role:
        name: sshd
        apply:
          tags: sshd

    - name: ensure bind9 is configured
      when: ansible_hostname in bind9_zones | default([]) | json_query('[*].master')
      tags: bind9
      ansible.builtin.include_role:
        name: bind9
        apply:
          tags: bind9
